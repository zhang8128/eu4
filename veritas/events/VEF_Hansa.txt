namespace = vef_hansa
normal_or_historical_nations = yes

#1 Invitation to Hansa
#2 Request to Join
#3 Agreed
#4 Refused

#10000 Hansa Election - Regular
#10001 Delayed election afte war over
#10010 Vote
#10020 Count Votes
#10021 War ends the vote
#10030 Same leader = leader event
#10040 Same leader = others event
#10050 New leader - leader event
#10060 New leader - others event
#10100 Hansa Election = Death
#10110 Restore union on peace
#10120 Tied - Revote
#10200 Leader vassalized - old leader
#10220 Leader vassalized - vote
#10240 Emergency vote - leader

#11000 Member - No valid provinces
#11001 Member Out - Inform Hansa

#20000 Hansa Gone
#20001 Hansa Gone - members
#20002 Captured Kontor - Eligible to join
#20003 Captured Kontor - Not Eligible

#30000 Kontors for Hansa
#30001 Open New Kontor
#30002 Kontor Offered
#30003 Inform Hansa of new Kontor

#40000 Expelled by Hansa
#40001 Member Leaves - Hansa
#40002 Member Joins - Hansa

# Invitation to Hansa
country_event = {
	id = vef_hansa.1
	title = "vef_hansa.1.t"
	desc = "vef_hansa.1.d"
	picture = VEF_DEBATE_REPUBLICAN_eventPicture

	is_triggered_only = yes #diplomatic action	
	
	option = {
		name = "vef_hansa.1.opta"
		add_trust = {
			who = FROM
			value = 5
			mutual = yes
		}
		add_country_modifier = { name = "hanseatic_league_member" duration = -1 }
		every_country = {
			limit = { has_country_modifier = hanseatic_league_member }
			add_opinion = { who = PREV modifier = hanseatic_league_friendship }
		}
		FROM = { country_event = { id = vef_hansa.3 }}
	}
	
	option = {
		name = "vef_hansa.1.optb"
		FROM = {
			add_trust = {
				who = ROOT
				value = -10
				mutual = no
			}
			country_event = { id = vef_hansa.4 }
		}
	}
}

# Request to join Hansa
country_event = {
	id = vef_hansa.2
	title = "vef_hansa.2.t"
	desc = "vef_hansa.2.d"
	picture = VEF_DEBATE_REPUBLICAN_eventPicture

	is_triggered_only = yes #diplomatic action	
	
	option = {
		name = "vef_hansa.2.opta"
		add_trust = {
			who = FROM
			value = 5
			mutual = yes
		}
		FROM = {
			add_country_modifier = { name = "hanseatic_league_member" duration = -1 }
			every_country = {
				limit = { has_country_modifier = hanseatic_league_member }
				add_opinion = { who = PREV modifier = hanseatic_league_friendship }
			}
			country_event = { id = vef_hansa.3 }
		}
	}
	
	option = {
		name = "vef_hansa.2.optb"
		FROM = {
			add_trust = {
				who = ROOT
				value = -10
				mutual = no
			}
			country_event = { id = vef_hansa.4 }
		}
	}
}

# Agrees
country_event = {
	id = vef_hansa.3
	title = "vef_hansa.3.t"
	desc = "vef_hansa.3.d"
	picture = VEF_DEBATE_REPUBLICAN_eventPicture

	is_triggered_only = yes #vef_hansa.1/2	
	
	option = {
		name = "vef_hansa.3.opta"
	}
}

# Refuses
country_event = {
	id = vef_hansa.4
	title = "vef_hansa.4.t"
	desc = "vef_hansa.4.d"
	picture = VEF_DEBATE_REPUBLICAN_eventPicture

	is_triggered_only = yes #vef_hansa.1/2
	
	option = {
		name = "vef_hansa.4.opta"
	}
}

# Time to choose the next leader
country_event = {
	id = vef_hansa.10000
	title = "vef_hansa.10000.t"
	desc = "vef_hansa.10000.d"
	picture = VEF_DEBATE_REPUBLICAN_eventPicture

	is_triggered_only = yes	#on_actions/on_new_term_election 

	trigger = {
	    event_target:hansa_leader_tag = { tag = ROOT }
	    NOT = { exists = HSA }
        has_country_flag = hansa_leader
        NOT = { has_country_flag = hansa_vote_called }
	}

	immediate = {
	    hidden_effect = {
	        set_global_flag = hansa_no_leader
	        set_country_flag = hansa_vote_called
	        DNZ = { clr_country_flag = hansa_voted }
	        HAM = { clr_country_flag = hansa_voted }
	        BRM = { clr_country_flag = hansa_voted }
	        LUB = { clr_country_flag = hansa_voted }
	        set_variable = { which = hansa_votes_lub value = 0 }
            set_variable = { which = hansa_votes_brm value = 0 }
            set_variable = { which = hansa_votes_dnz value = 0 }
            set_variable = { which = hansa_votes_ham value = 0 }
	    }
	}

	# Call for a vote
	option = {
		trigger = { is_at_war = no }
        name = "vef_hansa.10000.opta"
        if = {
        	limit = { NOT = { monthly_income = 14 } }
        	add_treasury = -10
        }
        if = {
        	limit = {
        	 	monthly_income = 14
        		NOT = { monthly_income = 208 }
        	}
        	add_years_of_income = -0.06
        }
        if = {
        	limit = { monthly_income = 208 }
        	add_treasury = -150
        }
        every_country = {
            limit = {
                has_country_flag = hansa_city_state
                OR = {
                    is_subject = no
                    is_subject_of = ROOT
                }
            }
            hidden_effect = {
                country_event = {
                    id = vef_hansa.10010
                    days = 20
                }
            }
        }
	}

	# Delayed when at war
	option = {
		trigger = { is_at_war = yes }
	    name = "vef_hansa.10000.optb"
	    hidden_effect = {
	        clr_country_flag = hansa_vote_called
	        set_country_flag = hansa_war_revote
	    }
	}
}

#Delayed election when war is over
country_event = {
	id = vef_hansa.10001
	title = "vef_hansa.10001.t"
	desc = "vef_hansa.10001.d"
	picture = VEF_DEBATE_REPUBLICAN_eventPicture

    is_triggered_only = yes	#on_actions/on_peace_actor or on_peace_recipient

	trigger = {
		event_target:hansa_leader_tag = { tag = ROOT }
	    NOT = { exists = HSA }
        has_country_flag = hansa_war_revote
        is_at_war = no
        has_country_flag = hansa_leader
        NOT = { has_country_flag = hansa_vote_called }
	}

	immediate = {
	    hidden_effect = {
	        set_country_flag = hansa_vote_called
	        clr_country_flag = hansa_war_revote
	        DNZ = { clr_country_flag = hansa_voted }
	        HAM = { clr_country_flag = hansa_voted }
	        BRM = { clr_country_flag = hansa_voted }
	        LUB = { clr_country_flag = hansa_voted }
	        set_variable = { which = hansa_votes_lub value = 0 }
            set_variable = { which = hansa_votes_brm value = 0 }
            set_variable = { which = hansa_votes_dnz value = 0 }
            set_variable = { which = hansa_votes_ham value = 0 }
	    }
	}

	# Call for a vote
	option = {
        name = "vef_hansa.10001.opta"

        if = {
        	limit = { NOT = { monthly_income = 14 } }
        	add_treasury = -10
        }
        if = {
        	limit = {
        	 	monthly_income = 14
        		NOT = { monthly_income = 208 }
        	}
        	add_years_of_income = -0.06
        }
        if = {
        	limit = { monthly_income = 208 }
        	add_treasury = -150
        }
        every_country = {
            limit = { has_country_flag = hansa_city_state }
            hidden_effect = { country_event = { id = vef_hansa.10010 days = 20 }}
        }
	}
}

# Vote!
country_event = {
	id = vef_hansa.10010
	title = "vef_hansa.10010.t"
	desc = "vef_hansa.10010.d"
	picture = VEF_DEBATE_REPUBLICAN_eventPicture

	is_triggered_only = yes # vef_hansa.10000 or vef_hansa.10001

	trigger = {
	    NOT = { exists = HSA }
	    has_country_flag = hansa_city_state
	    OR = {
	        is_subject_of = FROM
	        is_subject = no
	    }
	}

	#Lubeck
	option = {
	    name = "vef_hansa.10010.opta"

	    trigger = {
	        exists = LUB
            LUB = {
                OR = {
                    is_subject_of = FROM
                    is_subject = no
                }
            }
            has_country_flag = hansa_city_state
            OR = {
                ai = no
                NOT = { tag = LUB }
            }
	    }

	    ai_chance = {
	        factor = 25
	        modifier = {
	            factor = 1.5
	            capital_scope = {
	                is_strongest_trade_power = LUB
	            }
	        }
	        modifier = {
	            factor = 1.05
	            capital_scope = {
	                has_trader = LUB
	            }
	        }
	        modifier = {
	            factor = 1.1
	            LUB = { has_country_flag = hansa_leader }
	        }
    	    modifier = {
	            factor = 0.7
	            LUB = {
	                has_country_flag = hansa_leader
	                ai = no
	            }
	        }
	        modifier = {
	            factor = 0.8
	            LUB = { had_country_flag = { flag = hansa_leader days = 2920 } }
	        }
	        modifier = {
	            factor = 0.6
	            LUB = { had_country_flag = { flag = hansa_leader days = 5840 } }
	        }
	        modifier = {
	            factor = 0.4
	            LUB = { had_country_flag = { flag = hansa_leader days = 8760 } }
	        }
	        modifier = {
	            factor = 0.2
	            LUB = { had_country_flag = { flag = hansa_leader days = 18250 } }
	        }
	        modifier = {
	            factor = 0.9
	            army_size = LUB
	        }
	        modifier = {
	            factor = 0.5
	            prestige = LUB
	        }
	        modifier = {
	            factor = 0.6
	            num_of_light_ship = LUB
	        }
	        modifier = {
	            factor = 0.5
	            OR = {
	                trade_embargo_by = LUB
	                trade_embargoing = LUB
	            }
	        }
	        modifier = {
	            factor = 0.9
	            has_opinion = { who = LUB value = 0 }
	            NOT = { has_opinion = { who = LUB value = 50 } }
	        }
            modifier = {
	            factor = 0.5
	            has_opinion = { who = LUB value = -50 }
	            NOT = { has_opinion = { who = LUB value = 0 } }
	        }
   	        modifier = {
	            factor = 0.2
	            has_opinion = { who = LUB value = -100 }
	            NOT = { has_opinion = { who = LUB value = -50 } }
	        }
            modifier = {
	            factor = 0
	            NOT = { has_opinion = { who = LUB value = -100 } }
	        }
	        modifier = {
	            factor = 0.8
  	            LUB = { has_casus_belli_against = ROOT }
	        }
	    }
	        
        hidden_effect = {
            FROM = { change_variable = { which = hansa_votes_lub value = 1 } }
            set_country_flag = hansa_voted
            event_target:hansa_leader_tag = { country_event = { id = vef_hansa.10020 }}
        }
	}

    #Bremen
	option = {
	    name = "vef_hansa.10010.optb"

	    trigger = {
	        exists = BRM
            BRM = {
                OR = {
                    is_subject_of = FROM
                    is_subject = no
                }
            }
            has_country_flag = hansa_city_state
            OR = {
                ai = no
                NOT = { tag = BRM }
            }
	    }

	    ai_chance = {
	        factor = 25
	        modifier = {
	            factor = 1.5
	            capital_scope = {
	                is_strongest_trade_power = BRM
	            }
	        }
	        modifier = {
	            factor = 1.05
	            capital_scope = {
	                has_trader = BRM
	            }
	        }
	        modifier = {
	            factor = 1.1
	            BRM = { has_country_flag = hansa_leader }
	        }
	        modifier = {
	            factor = 0.7
	            BRM = {
	                has_country_flag = hansa_leader
	                ai = no
	            }
	        }
	        modifier = {
	            factor = 0.8
	            BRM = { had_country_flag = { flag = hansa_leader days = 2920 } }
	        }
	        modifier = {
	            factor = 0.6
	            BRM = { had_country_flag = { flag = hansa_leader days = 5840 } }
	        }
	        modifier = {
	            factor = 0.4
	            BRM = { had_country_flag = { flag = hansa_leader days = 8760 } }
	        }
	        modifier = {
	            factor = 0.2
	            BRM = { had_country_flag = { flag = hansa_leader days = 18250 } }
	        }
	        modifier = {
	            factor = 0.9
	            army_size = BRM
	        }
	        modifier = {
	            factor = 0.5
	            prestige = BRM
	        }
	        modifier = {
	            factor = 0.6
	            num_of_light_ship = BRM
	        }
	        modifier = {
	            factor = 0.5
	            OR = {
	                trade_embargo_by = BRM
	                trade_embargoing = BRM
	            }
	        }
	        modifier = {
	            factor = 0.9
	            has_opinion = { who = BRM value = 0 }
	            NOT = { has_opinion = { who = BRM value = 50 } }
	        }
            modifier = {
	            factor = 0.5
	            has_opinion = { who = BRM value = -50 }
	            NOT = { has_opinion = { who = BRM value = 0 } }
	        }
   	        modifier = {
	            factor = 0.2
	            has_opinion = { who = BRM value = -100 }
	            NOT = { has_opinion = { who = BRM value = -50 } }
	        }
            modifier = {
	            factor = 0
	            NOT = { has_opinion = { who = BRM value = -100 } }
	        }
	        modifier = {
	            factor = 0.8
	            BRM = { has_casus_belli_against = ROOT }
	        }
	    }

        hidden_effect = {
            FROM = { change_variable = { which = hansa_votes_brm value = 1 } }
            set_country_flag = hansa_voted
            event_target:hansa_leader_tag = { country_event = { id = vef_hansa.10020 }}
        }
	}
	
	#Danzig
	option = {
	    name = "vef_hansa.10010.optc"

	    trigger = {
	        exists = DNZ
            DNZ = {
                OR = {
                    is_subject_of = FROM
                    is_subject = no
                }
            }
            has_country_flag = hansa_city_state
            OR = {
                ai = no
                NOT = { tag = DNZ }
            }
	    }

	    ai_chance = {
	        factor = 25
	        modifier = {
	            factor = 1.5
	            capital_scope = {
	                is_strongest_trade_power = DNZ
	            }
	        }
	        modifier = {
	            factor = 1.05
	            capital_scope = {
	                has_trader = DNZ
	            }
	        }
	        modifier = {
	            factor = 1.1
	            DNZ = { has_country_flag = hansa_leader }
	        }
	        modifier = {
	            factor = 0.7
	            DNZ = {
	                has_country_flag = hansa_leader
	                ai = no
	            }
	        }
	        modifier = {
	            factor = 0.8
	            DNZ = { had_country_flag = { flag = hansa_leader days = 2920 } }
	        }
	        modifier = {
	            factor = 0.6
	            DNZ = { had_country_flag = { flag = hansa_leader days = 5840 } }
	        }
	        modifier = {
	            factor = 0.4
	            DNZ = { had_country_flag = { flag = hansa_leader days = 8760 } }
	        }
	        modifier = {
	            factor = 0.2
	            DNZ = { had_country_flag = { flag = hansa_leader days = 18250 } }
	        }
	        modifier = {
	            factor = 0.9
	            army_size = DNZ
	        }
	        modifier = {
	            factor = 0.5
	            prestige = DNZ
	        }
	        modifier = {
	            factor = 0.6
	            num_of_light_ship = DNZ
	        }
	        modifier = {
	            factor = 0.5
	            OR = {
	                trade_embargo_by = DNZ
	                trade_embargoing = DNZ
	            }
	        }
	        modifier = {
	            factor = 0.9
	            has_opinion = { who = DNZ value = 0 }
	            NOT = { has_opinion = { who = DNZ value = 50 } }
	        }
            modifier = {
	            factor = 0.5
	            has_opinion = { who = DNZ value = -50 }
	            NOT = { has_opinion = { who = DNZ value = 0 } }
	        }
   	        modifier = {
	            factor = 0.2
	            has_opinion = { who = DNZ value = -100 }
	            NOT = { has_opinion = { who = DNZ value = -50 } }
	        }
            modifier = {
	            factor = 0
	            NOT = { has_opinion = { who = DNZ value = -100 } }
	        }
	        modifier = {
	            factor = 0.8
	            DNZ = { has_casus_belli_against = ROOT }
	        }
	    }
	        
        hidden_effect = {
            FROM = { change_variable = { which = hansa_votes_dnz value = 1 } }
            set_country_flag = hansa_voted
            event_target:hansa_leader_tag = { country_event = { id = vef_hansa.10020 }}
        }
	}
	
    #Hamburg
	option = {
	    name = "vef_hansa.10010.optd"

	    trigger = {
	        exists = HAM
            HAM = {
                OR = {
                    is_subject_of = FROM
                    is_subject = no
                }
            }
            has_country_flag = hansa_city_state
            OR = {
                ai = no
                NOT = { tag = HAM }
            }
	    }

	    ai_chance = {
	        factor = 25
	        modifier = {
	            factor = 1.5
	            capital_scope = {
	                is_strongest_trade_power = HAM
	            }
	        }
	        modifier = {
	            factor = 1.05
	            capital_scope = {
	                has_trader = HAM
	            }
	        }
	        modifier = {
	            factor = 1.1
	            HAM = { has_country_flag = hansa_leader }
	        }
	        modifier = {
	            factor = 0.7
	            HAM = {
	                has_country_flag = hansa_leader
	                ai = no
	            }
	        }
	        modifier = {
	            factor = 0.8
	            HAM = { had_country_flag = { flag = hansa_leader days = 2920 } }
	        }
	        modifier = {
	            factor = 0.6
	            HAM = { had_country_flag = { flag = hansa_leader days = 5840 } }
	        }
	        modifier = {
	            factor = 0.4
	            HAM = { had_country_flag = { flag = hansa_leader days = 8760 } }
	        }
	        modifier = {
	            factor = 0.2
	            HAM = { had_country_flag = { flag = hansa_leader days = 18250 } }
	        }
	        modifier = {
	            factor = 0.9
	            army_size = HAM
	        }
	        modifier = {
	            factor = 0.5
	            prestige = HAM
	        }
	        modifier = {
	            factor = 0.6
	            num_of_light_ship = HAM
	        }
	        modifier = {
	            factor = 0.5
	            OR = {
	                trade_embargo_by = HAM
	                trade_embargoing = HAM
	            }
	        }
	        modifier = {
	            factor = 0.9
	            has_opinion = { who = HAM value = 0 }
	            NOT = { has_opinion = { who = HAM value = 50 } }
	        }
            modifier = {
	            factor = 0.5
	            has_opinion = { who = HAM value = -50 }
	            NOT = { has_opinion = { who = HAM value = 0 } }
	        }
   	        modifier = {
	            factor = 0.2
	            has_opinion = { who = HAM value = -100 }
	            NOT = { has_opinion = { who = HAM value = -50 } }
	        }
            modifier = {
	            factor = 0
	            NOT = { has_opinion = { who = HAM value = -100 } }
	        }
	        modifier = {
	            factor = 0.8
                HAM = { has_casus_belli_against = ROOT }
	        }
	    }
	        
        hidden_effect = {
            FROM = { change_variable = { which = hansa_votes_ham value = 1 } }
            set_country_flag = hansa_voted
            event_target:hansa_leader_tag = { country_event = { id = vef_hansa.10020 }}
        }
	}

	#Self
	option = {
	    name = "vef_hansa.10010.opte"

	    trigger = {
            has_country_flag = hansa_city_state
            OR = {
                is_subject_of = FROM
                is_subject = no
            }
            ai = yes
	    }

	    ai_chance = {
	        factor = 25
	        modifier = {
	            factor = 1.5
	            capital_scope = {
	                is_strongest_trade_power = ROOT
	            }
	        }
	        modifier = {
	            factor = 1.05
	            capital_scope = {
	                has_trader = ROOT
	            }
	        }
	        modifier = {
	            factor = 0.7
	            any_known_country = {
	                OR = {
	                    NOT = { has_country_flag = hansa_city_state }
	                    AND = {
	                        army_size = ROOT
	                        has_country_flag = hansa_city_state
	                    }
	                }
	            }
	        }
	        modifier = {
	            factor = 0.5
	            any_known_country = {
	                OR = {
	                    NOT = { has_country_flag = hansa_city_state }
                        AND = {
                            prestige = ROOT
                            has_country_flag = hansa_city_state
                        }
	                }
	            }
	        }
	        modifier = {
	            factor = 0.3
	            any_known_country = {
	                OR = {
	                    NOT = { has_country_flag = hansa_city_state }
    	                AND = {
    	                    num_of_light_ship = ROOT
    	                    has_country_flag = hansa_city_state
    	                }
    	            }
    	        }
	        }
	    }

        hidden_effect = {
            if = {
                limit = { tag = LUB }
                FROM = { change_variable = { which = hansa_votes_lub value = 1 } }
            }
            if = {
                limit = { tag = BRM }
                FROM = { change_variable = { which = hansa_votes_brm value = 1 } }
            }
            if = {
                limit = { tag = DNZ }
                FROM = { change_variable = { which = hansa_votes_dnz value = 1 } }
            }
            if = {
                limit = { tag = HAM }
				FROM = { change_variable = { which = hansa_votes_ham value = 1 } }
			}
			set_country_flag = hansa_voted
			event_target:hansa_leader_tag = { country_event = { id = vef_hansa.10020 }}
        }
	}
}

# Count votes
country_event = {
	id = vef_hansa.10020
	title = "vef_hansa.10020.t"
	desc = "vef_hansa.10020.d"
	picture = VEF_DEBATE_REPUBLICAN_eventPicture
	
	is_triggered_only = yes # vef_hansa.10010
	
	trigger = {
	    has_country_flag = hansa_voted
	    all_known_country = {
	        OR = {
	            NOT = { has_country_flag = hansa_city_state }
            	has_country_flag = hansa_voted
            }
	    }
	}

    #Current stays leader
    option = {
        name = "vef_hansa.10020.opt"
        trigger = {
            is_at_war = no
            OR = {
                AND = {
                    tag = LUB
                    check_variable = { which = hansa_votes_lub which = hansa_votes_dnz }
                    check_variable = { which = hansa_votes_lub which = hansa_votes_ham }
                    check_variable = { which = hansa_votes_lub which = hansa_votes_brm }
                }
                AND = {
                    tag = BRM
                    check_variable = { which = hansa_votes_brm which = hansa_votes_dnz }
                    check_variable = { which = hansa_votes_brm which = hansa_votes_ham }
                    check_variable = { which = hansa_votes_brm which = hansa_votes_lub }
                }
                AND = {
                    tag = DNZ
                    check_variable = { which = hansa_votes_dnz which = hansa_votes_lub }
                    check_variable = { which = hansa_votes_dnz which = hansa_votes_ham }
                    check_variable = { which = hansa_votes_dnz which = hansa_votes_brm }
                }
                AND = {
                    tag = HAM
                    check_variable = { which = hansa_votes_ham which = hansa_votes_brm }
                    check_variable = { which = hansa_votes_ham which = hansa_votes_lub }
                    check_variable = { which = hansa_votes_ham which = hansa_votes_dnz }
                }
            }
        }

        hidden_effect = {
            clr_country_flag = hansa_vote_called
            country_event = { id = vef_hansa.10030 }
            every_country = {
                limit = {
                    has_country_flag = hansa_city_state
                    NOT = { tag = ROOT }
                }
                country_event = { id = vef_hansa.10040 }            
            }
        }
    }

    #LUB new leader
    option = {
        name = "vef_hansa.10020.opt"
        trigger = {
        	NOT = { tag = LUB }
            is_at_war = no
            check_variable = { which = hansa_votes_lub which = hansa_votes_dnz }
            check_variable = { which = hansa_votes_lub which = hansa_votes_ham }
            check_variable = { which = hansa_votes_lub which = hansa_votes_brm }
            NOT = { check_variable = { which = hansa_votes_dnz which = hansa_votes_lub } }
            NOT = { check_variable = { which = hansa_votes_ham which = hansa_votes_lub } }
            NOT = { check_variable = { which = hansa_votes_brm which = hansa_votes_lub } }
        }

        hidden_effect = {
            clr_country_flag = hansa_vote_called
            LUB = { country_event = { id = vef_hansa.10050 }}
        }
    }

    #BRM new leader
    option = {
        name = "vef_hansa.10020.opt"
        trigger = {
        	NOT = { tag = BRM }
            is_at_war = no
            check_variable = { which = hansa_votes_brm which = hansa_votes_dnz }
            check_variable = { which = hansa_votes_brm which = hansa_votes_ham }
            check_variable = { which = hansa_votes_brm which = hansa_votes_lub }
            NOT = { check_variable = { which = hansa_votes_dnz which = hansa_votes_brm } }
            NOT = { check_variable = { which = hansa_votes_ham which = hansa_votes_brm } }
            NOT = { check_variable = { which = hansa_votes_lub which = hansa_votes_brm } }
        }

        hidden_effect = {
            clr_country_flag = hansa_vote_called
            BRM = { country_event = { id = vef_hansa.10050 }}
        }
    }

    #DNZ new leader
    option = {
        name = "vef_hansa.10020.opt"
        trigger = {
        	NOT = { tag = DNZ }
            is_at_war = no
            check_variable = { which = hansa_votes_dnz which = hansa_votes_lub }
            check_variable = { which = hansa_votes_dnz which = hansa_votes_ham }
            check_variable = { which = hansa_votes_dnz which = hansa_votes_brm }
            NOT = { check_variable = { which = hansa_votes_brm which = hansa_votes_dnz } }
            NOT = { check_variable = { which = hansa_votes_ham which = hansa_votes_dnz } }
            NOT = { check_variable = { which = hansa_votes_lub which = hansa_votes_dnz } }
        }

        hidden_effect = {
            clr_country_flag = hansa_vote_called
            DNZ = { country_event = { id = vef_hansa.10050 }}
        }
    }

    #HAM new leader
    option = {
        name = "vef_hansa.10020.opt"
        trigger = {
        	NOT = { tag = HAM }
            is_at_war = no
            check_variable = { which = hansa_votes_ham which = hansa_votes_dnz }
            check_variable = { which = hansa_votes_ham which = hansa_votes_lub }
            check_variable = { which = hansa_votes_ham which = hansa_votes_brm }
            NOT = { check_variable = { which = hansa_votes_dnz which = hansa_votes_ham } }
            NOT = { check_variable = { which = hansa_votes_brm which = hansa_votes_ham } }
            NOT = { check_variable = { which = hansa_votes_lub which = hansa_votes_ham } }
        }

        hidden_effect = {
            clr_country_flag = hansa_vote_called
            HAM = { country_event = { id = vef_hansa.10050 }}
        }
    }

    #Tied for other leader
    option = {
        name = "vef_hansa.10020.opt"
        trigger = {
            is_at_war = no
            OR = {
                AND = {
                   tag = LUB
                    OR = {
                        AND = {
                            check_variable = { which = hansa_votes_brm which = hansa_votes_dnz }
                            check_variable = { which = hansa_votes_dnz which = hansa_votes_brm }
                            check_variable = { which = hansa_votes_dnz which = hansa_votes_ham }
                            NOT = { check_variable = { which = hansa_votes_ham which = hansa_votes_dnz } }
                            check_variable = { which = hansa_votes_dnz which = hansa_votes_lub }
                            NOT = { check_variable = { which = hansa_votes_lub which = hansa_votes_dnz } }
                        }
                        AND = {
                            check_variable = { which = hansa_votes_brm which = hansa_votes_ham }
                            check_variable = { which = hansa_votes_ham which = hansa_votes_brm }
                            check_variable = { which = hansa_votes_ham which = hansa_votes_dnz }
                            NOT = { check_variable = { which = hansa_votes_dnz which = hansa_votes_ham } }
                            check_variable = { which = hansa_votes_ham which = hansa_votes_lub }
                            NOT = { check_variable = { which = hansa_votes_lub which = hansa_votes_ham } }
                        }
                        AND = {
                            check_variable = { which = hansa_votes_dnz which = hansa_votes_ham }
                            check_variable = { which = hansa_votes_ham which = hansa_votes_dnz }
                            check_variable = { which = hansa_votes_ham which = hansa_votes_brm }
                            NOT = { check_variable = { which = hansa_votes_brm which = hansa_votes_ham } }
                            check_variable = { which = hansa_votes_ham which = hansa_votes_lub }
                            NOT = { check_variable = { which = hansa_votes_lub which = hansa_votes_ham } }
                        }
                    }
                }
                AND = {
                    tag = BRM
                    OR = {
                        AND = {
                            check_variable = { which = hansa_votes_lub which = hansa_votes_dnz }
                            check_variable = { which = hansa_votes_dnz which = hansa_votes_lub }
                            check_variable = { which = hansa_votes_dnz which = hansa_votes_ham }
                            NOT = { check_variable = { which = hansa_votes_ham which = hansa_votes_dnz } }
                            check_variable = { which = hansa_votes_dnz which = hansa_votes_brm }
                            NOT = { check_variable = { which = hansa_votes_brm which = hansa_votes_dnz } }
                        }
                        AND = {
                            check_variable = { which = hansa_votes_dnz which = hansa_votes_ham }
                            check_variable = { which = hansa_votes_ham which = hansa_votes_dnz }
                            check_variable = { which = hansa_votes_ham which = hansa_votes_brm }
                            NOT = { check_variable = { which = hansa_votes_brm which = hansa_votes_ham } }
                            check_variable = { which = hansa_votes_ham which = hansa_votes_lub }
                            NOT = { check_variable = { which = hansa_votes_lub which = hansa_votes_ham } }
                        }
                        AND = {
                            check_variable = { which = hansa_votes_lub which = hansa_votes_ham }
                            check_variable = { which = hansa_votes_ham which = hansa_votes_lub }
                            check_variable = { which = hansa_votes_ham which = hansa_votes_brm }
                            NOT = { check_variable = { which = hansa_votes_brm which = hansa_votes_ham } }
                            check_variable = { which = hansa_votes_ham which = hansa_votes_dnz }
                            NOT = { check_variable = { which = hansa_votes_dnz which = hansa_votes_ham } }
                        }
                    }
                }
                AND = {
                	tag = DNZ
                    OR = {
                        AND = {
                            check_variable = { which = hansa_votes_brm which = hansa_votes_lub }
                            check_variable = { which = hansa_votes_lub which = hansa_votes_brm }
                            check_variable = { which = hansa_votes_lub which = hansa_votes_ham }
                            NOT = { check_variable = { which = hansa_votes_ham which = hansa_votes_lub } }
                            check_variable = { which = hansa_votes_lub which = hansa_votes_dnz }
                            NOT = { check_variable = { which = hansa_votes_dnz which = hansa_votes_lub } }
                        }
                        AND = {
                            check_variable = { which = hansa_votes_brm which = hansa_votes_ham }
                            check_variable = { which = hansa_votes_ham which = hansa_votes_brm }
                            check_variable = { which = hansa_votes_ham which = hansa_votes_lub }
                            NOT = { check_variable = { which = hansa_votes_lub which = hansa_votes_ham } }
                            check_variable = { which = hansa_votes_ham which = hansa_votes_dnz }
                            NOT = { check_variable = { which = hansa_votes_dnz which = hansa_votes_ham } }
                        }
                        AND = {
                            check_variable = { which = hansa_votes_lub which = hansa_votes_ham }
                            check_variable = { which = hansa_votes_ham which = hansa_votes_lub }
                            check_variable = { which = hansa_votes_ham which = hansa_votes_brm }
                            NOT = { check_variable = { which = hansa_votes_brm which = hansa_votes_ham } }
                            check_variable = { which = hansa_votes_ham which = hansa_votes_dnz }
                            NOT = { check_variable = { which = hansa_votes_dnz which = hansa_votes_ham } }
                        }
                    }
                }
                AND = {
                    tag = HAM
                    OR = {
                        AND = {
                            check_variable = { which = hansa_votes_brm which = hansa_votes_lub }
                            check_variable = { which = hansa_votes_lub which = hansa_votes_brm }
                            check_variable = { which = hansa_votes_lub which = hansa_votes_ham }
                            NOT = { check_variable = { which = hansa_votes_ham which = hansa_votes_lub } }
                            check_variable = { which = hansa_votes_lub which = hansa_votes_dnz }
                            NOT = { check_variable = { which = hansa_votes_dnz which = hansa_votes_lub } }
                        }
                        AND = {
                            check_variable = { which = hansa_votes_lub which = hansa_votes_dnz }
                            check_variable = { which = hansa_votes_dnz which = hansa_votes_lub }
                            check_variable = { which = hansa_votes_dnz which = hansa_votes_ham }
                            NOT = { check_variable = { which = hansa_votes_ham which = hansa_votes_dnz } }
                            check_variable = { which = hansa_votes_dnz which = hansa_votes_brm }
                            NOT = { check_variable = { which = hansa_votes_brm which = hansa_votes_dnz } }
                        }
                        AND = {
                            check_variable = { which = hansa_votes_dnz which = hansa_votes_brm }
                            check_variable = { which = hansa_votes_brm which = hansa_votes_dnz }
                            check_variable = { which = hansa_votes_brm which = hansa_votes_ham }
                            NOT = { check_variable = { which = hansa_votes_ham which = hansa_votes_brm } }
                            check_variable = { which = hansa_votes_brm which = hansa_votes_lub }
                            NOT = { check_variable = { which = hansa_votes_lub which = hansa_votes_brm } }
                        }
                    }
                }
            }
        }
        hidden_effect = {
            clr_country_flag = hansa_vote_called
            country_event = { id = vef_hansa.10120 days = 30 }
            every_country = {
                limit = { has_country_flag = hansa_city_state }
                country_event = { id = vef_hansa.10130 }
            }
        }
    }

    #War
    option = {
        name = "vef_hansa.10020.optb"
        trigger = { is_at_war = yes }
        hidden_effect = {
            set_country_flag = hansa_war_revote
            clr_country_flag = hansa_vote_called
            every_country = {
                limit = { has_country_flag = hansa_city_state }
				country_event = { id = vef_hansa.10021 }
            }
        }
    }
}

#Cancel - war
country_event = {
	id = vef_hansa.10021
	title = "vef_hansa.10021.t"
	desc = "vef_hansa.10021.d"
	picture = VEF_DEBATE_REPUBLICAN_eventPicture

    is_triggered_only = yes	#vef_hansa.10020

    option = {
        name = "vef_hansa.10021.opta"
    }

}

# Same leader - leader
country_event = {
	id = vef_hansa.10030
	title = "vef_hansa.10030.t"
	desc = "vef_hansa.10030.d"
	picture = VEF_DEBATE_REPUBLICAN_eventPicture

	is_triggered_only = yes	#vef_hansa.10020

	major = yes

	trigger = {
	    NOT = { exists = HSA }
	}

	immediate = {
	    hidden_effect = {
	        clr_global_flag = hansa_no_leader
	        clr_country_flag = hansa_voted
	        change_variable = { which = hansa_consecutive_votes value = 1 }
	    }
	}

	option = {
	    name = "vef_hansa.10030.opta"

        if = {
            limit = { NOT = {  has_ruler = "Merchant Council" }}
            change_adm = 1
            change_mil = 1
            change_dip = 1
            add_prestige = 10
	    }
	    if = {
	        limit = { has_ruler = "Merchant Council" }
	        define_ruler = {}
	    }
	    every_country = {
			limit = {
				has_country_flag = hansa_city_state
				NOT = { tag = ROOT }
			}
			grant_independence = yes
			ROOT = { create_subject = { subject_type = hansa_union subject = PREV }}
        }
        add_scaled_republican_tradition = -0.05
	}
}

# Same leader - others
country_event = {
	id = vef_hansa.10040
	title = "vef_hansa.10040.t"
	desc = "vef_hansa.10040.d"
	picture = VEF_DEBATE_REPUBLICAN_eventPicture

	is_triggered_only = yes	#vef_hansa.10020

	trigger = {
	    NOT = { exists = HSA }
	}

	immediate = {
	    hidden_effect = {
	        clr_country_flag = hansa_voted
	    }
	}

	option = {
	    name = "vef_hansa.10040.opta"

	    add_prestige = 5
	    add_scaled_republican_tradition = -0.05
        if = {
            limit = { NOT = { has_opinion_modifier = { who = ROOT modifier = hansa_leader_opinion } } }
            add_opinion = { who = ROOT modifier = hansa_leader_opinion }
        }
	}
}

# New leader - leader
country_event = {
	id = vef_hansa.10050
	title = "vef_hansa.10050.t"
	desc = "vef_hansa.10050.d"
	picture = VEF_DEBATE_REPUBLICAN_eventPicture

	is_triggered_only = yes	#vef_hansa.10020

	major = yes

	trigger = {
	    NOT = { exists = HSA }
	}

	immediate = {
	    hidden_effect = {
	        clr_global_flag = hansa_no_leader
	        clr_country_flag = hansa_voted
            FROM = {
                set_variable = { which = hansa_consecutive_votes value = 0 }
                ROOT = { grant_independence = yes }
                clr_country_flag = hansa_leader
                remove_country_modifier = "hansa_leader_modifier"
            }
            set_variable = { which = hansa_consecutive_votes value = 1 }
            define_ruler = {}
	        every_country = {
	            limit = {
	                has_country_flag = hansa_city_state
	                NOT = { tag = ROOT }
	            }
	            ROOT = { create_subject = { subject_type = hansa_union subject = PREV }}
                country_event = { id = vef_hansa.10060 }
                remove_opinion = { who = FROM modifier = hansa_leader_opinion }
	        }
            set_country_flag = hansa_leader
            save_global_event_target_as = hansa_leader_tag
        }
	}

	option = {
	    name = "vef_hansa.10050.opta"

	    add_prestige = 20
	    add_scaled_republican_tradition = 0.10
	    add_country_modifier = { name = "hansa_leader_modifier" duration = -1 }

	}
}

# New leader - other
country_event = {
	id = vef_hansa.10060
	title = "vef_hansa.10060.t"
	desc = "vef_hansa.10060.d"
	picture = VEF_DEBATE_REPUBLICAN_eventPicture

	is_triggered_only = yes	# vef_hansa.10020

	trigger = {
	    NOT = { exists = HSA }
	}

	immediate = {
	    hidden_effect = {
	        clr_country_flag = hansa_voted
        }
	}

	option = {
	    name = "vef_hansa.10060.opta"

	    add_prestige = 5
	    add_scaled_republican_tradition = 0.10
	    add_opinion = { who = FROM modifier = hansa_leader_opinion }
	}
}

# Time to choose the next leader - Death
country_event = {
	id = vef_hansa.10100
	title = "vef_hansa.10100.t"
	desc = "vef_hansa.10100.d"
	picture = VEF_DEBATE_REPUBLICAN_eventPicture

    is_triggered_only = yes	#on_actions/on_death_election

	trigger = {
        has_country_flag = hansa_leader
	    NOT = { exists = HSA }
	    NOT = { has_country_flag = hansa_vote_called }
	}

	immediate = {
	    hidden_effect = {
   	        set_global_flag = hansa_no_leader
	        define_ruler = {
	            name = "Merchant Council"
                adm = 1
                dip = 1
                mil = 1
	        }
	        set_ruler_flag = vef_regency
	        set_country_flag = hansa_vote_called
	        DNZ = { clr_country_flag = hansa_voted }
	        HAM = { clr_country_flag = hansa_voted }
	        BRM = { clr_country_flag = hansa_voted }
	        LUB = { clr_country_flag = hansa_voted }
	        set_variable = { which = hansa_votes_lub value = 0 }
            set_variable = { which = hansa_votes_brm value = 0 }
            set_variable = { which = hansa_votes_dnz value = 0 }
            set_variable = { which = hansa_votes_ham value = 0 }
	    }
	}

	# Call for a vote
	option = {
        name = "vef_hansa.10100.opta"

        if = {
        	limit = { NOT = { monthly_income = 14 } }
        	add_treasury = -10
        }
        if = {
        	limit = {
        	 	monthly_income = 14
        		NOT = { monthly_income = 208 }
        	}
        	add_years_of_income = -0.06
        }
        if = {
        	limit = { monthly_income = 208 }
        	add_treasury = -150
        }
        hidden_effect = {
            every_country = {
                limit = { has_country_flag = hansa_city_state }
                country_event = { id = vef_hansa.10010 }
            }
        }
	}
}


# Peace - check if union forced apart
country_event = {
	id = vef_hansa.10110
	title = "vef_hansa.10110.t"
	desc = "vef_hansa.10110.d"
	picture = VEF_DEBATE_REPUBLICAN_eventPicture

    is_triggered_only = yes	#on_actions/on_peace

	trigger = {
		has_country_flag = hansa_city_state
        NOT = { has_country_flag = hansa_leader }
	    NOT = { exists = HSA }
        any_known_country = {
	        has_country_flag = hansa_leader
	        NOT = { senior_union_with = ROOT }
	        NOT = { is_subject = yes }
	    }
	}

	# Rejoin
	option = {
        name = "vef_hansa.10110.opta"
        hidden_effect = {
            every_known_country = {
                limit = { has_country_flag = hansa_leader }
                create_subject = { subject_type = hansa_union subject = ROOT }
            }
        }
	}
}

# Time to choose the next leader - Revote
country_event = {
	id = vef_hansa.10120
	title = "vef_hansa.10120.t"
	desc = "vef_hansa.10120.d"
	picture = VEF_DEBATE_REPUBLICAN_eventPicture

    is_triggered_only = yes	#vef_hansa.10020

	trigger = {
        has_country_flag = hansa_leader
	    NOT = { exists = HSA }
	}

	immediate = {
	    hidden_effect = {
	        set_country_flag = hansa_vote_called
	        DNZ = { clr_country_flag = hansa_voted }
	        HAM = { clr_country_flag = hansa_voted }
	        BRM = { clr_country_flag = hansa_voted }
	        LUB = { clr_country_flag = hansa_voted }
	        REB = {
                set_variable = { which = hansa_votes_lub value = 0 }
                set_variable = { which = hansa_votes_brm value = 0 }
                set_variable = { which = hansa_votes_dnz value = 0 }
                set_variable = { which = hansa_votes_ham value = 0 }
            }
	    }
	}

	# Call for a vote
	option = {
        name = "vef_hansa.10120.opta"
       	if = {
        	limit = { NOT = { monthly_income = 14 } }
        	add_treasury = -5
        }
        if = {
        	limit = {
        	 	monthly_income = 14
        		NOT = { monthly_income = 208 }
        	}
        	add_years_of_income = -0.03
        }
        if = {
        	limit = { monthly_income = 208 }
        	add_treasury = -75
        }
        hidden_effect = {
            every_country = {
                limit = { has_country_flag = hansa_city_state }
                country_event = { id = vef_hansa.10010 }
            }
        }
	}
}

# Tied
country_event = {
	id = vef_hansa.10130
	title = "vef_hansa.10130.t"
	desc = "vef_hansa.10130.d"
	picture = VEF_DEBATE_REPUBLICAN_eventPicture

    is_triggered_only = yes	#vef_hansa.10020

	trigger = {
        has_country_flag = hansa_city_state
	    NOT = { exists = HSA }
	}

	# Info
	option = {
        name = "vef_hansa.10130.opta"
	}
}

#Leader vassalized
country_event = {
    id = vef_hansa.10200
    title = "vef_hansa.10200.t"
    desc = "vef_hansa.10200.d"
    picture = VEF_DEBATE_REPUBLICAN_eventPicture

    trigger = {
        OR = {
            tag = LUB
            tag = HAM
            tag = BRM
            tag = DNZ
        }
        NOT = { exists = HSA }
        has_country_flag = hansa_leader
        is_at_war = no
        is_subject = yes
	}

    immediate = {
        hidden_effect = {
   	        set_global_flag = hansa_no_leader
	        clr_country_flag = hansa_leader
	        clear_global_event_target = hansa_leader_tag
	        set_global_flag = hansa_emergency_vote
        }
    }

    option = {
        name = "vef_hansa.10200.opta"
        remove_country_modifier = hansa_leader_modifier
        hidden_effect = {
            every_known_country = {
                limit = {
                    has_country_flag = hansa_city_state
                    NOT = { tag = ROOT }
                }
                remove_opinion = { who = ROOT modifier = hansa_leader_opinion }
    			grant_independence = yes
                country_event = { id = vef_hansa.10220 }
                set_global_flag = hansa_emergency_vote_started
                clr_global_flag = hansa_emergency_votes_counted
                REB = {
                    set_variable = { which = hansa_votes_lub value = 0 }
                    set_variable = { which = hansa_votes_brm value = 0 }
                    set_variable = { which = hansa_votes_dnz value = 0 }
                    set_variable = { which = hansa_votes_brm value = 0 }
                }
            }
        }
    }
}

# Vote! - No leader
country_event = {
	id = vef_hansa.10220
	title = "vef_hansa.10220.t"
	desc = "vef_hansa.10220.d"
	picture = VEF_DEBATE_REPUBLICAN_eventPicture

	is_triggered_only = yes	#vef_hansa.10200

	trigger = { is_subject = no }

	option = {
	    name = "vef_hansa.10220.opta"
	    trigger = {
	        exists = LUB
            LUB = { is_subject = no }
            has_country_flag = hansa_city_state
            OR = {
                ai = no
                NOT = { tag = LUB }
            }
	    }
	    ai_chance = {
	        factor = 25
	        modifier = {
	            factor = 1.5
	            capital_scope = {
	                is_strongest_trade_power = LUB
	            }
	        }
	        modifier = {
	            factor = 1.05
	            capital_scope = {
	                has_trader = LUB
	            }
	        }
	        modifier = {
	            factor = 0.9
	            army_size = LUB
	        }
	        modifier = {
	            factor = 0.5
	            prestige = LUB
	        }
	        modifier = {
	            factor = 0.6
	            num_of_light_ship = LUB
	        }
	        modifier = {
	            factor = 0.5
	            OR = {
	                trade_embargo_by = LUB
	                trade_embargoing = LUB
	            }
	        }
	        modifier = {
	            factor = 0.9
	            has_opinion = { who = LUB value = 0 }
	            NOT = { has_opinion = { who = LUB value = 50 } }
	        }
            modifier = {
	            factor = 0.5
	            has_opinion = { who = LUB value = -50 }
	            NOT = { has_opinion = { who = LUB value = 0 } }
	        }
   	        modifier = {
	            factor = 0.2
	            has_opinion = { who = LUB value = -100 }
	            NOT = { has_opinion = { who = LUB value = -50 } }
	        }
            modifier = {
	            factor = 0
	            NOT = { has_opinion = { who = LUB value = -100 } }
	        }
	        modifier = {
	            factor = 0.8
  	            LUB = { has_casus_belli_against = ROOT }
	        }
	    }

        hidden_effect = {
            REB = { change_variable = { which = hansa_votes_lub value = 1 } }
            set_country_flag = hansa_voted
        }
	}

    #Bremen
	option = {
	    name = "vef_hansa.10220.optb"

	    trigger = {
	        exists = BRM
            BRM = { is_subject = no }
            has_country_flag = hansa_city_state
            OR = {
                ai = no
                NOT = { tag = BRM }
            }
	    }

	    ai_chance = {
	        factor = 25
	        modifier = {
	            factor = 1.5
	            capital_scope = {
	                is_strongest_trade_power = BRM
	            }
	        }
	        modifier = {
	            factor = 1.05
	            capital_scope = {
	                has_trader = BRM
	            }
	        }
	        modifier = {
	            factor = 0.9
	            army_size = BRM
	        }
	        modifier = {
	            factor = 0.5
	            prestige = BRM
	        }
	        modifier = {
	            factor = 0.6
	            num_of_light_ship = BRM
	        }
	        modifier = {
	            factor = 0.5
	            OR = {
	                trade_embargo_by = BRM
	                trade_embargoing = BRM
	            }
	        }
	        modifier = {
	            factor = 0.9
	            has_opinion = { who = BRM value = 0 }
	            NOT = { has_opinion = { who = BRM value = 50 } }
	        }
            modifier = {
	            factor = 0.5
	            has_opinion = { who = BRM value = -50 }
	            NOT = { has_opinion = { who = BRM value = 0 } }
	        }
   	        modifier = {
	            factor = 0.2
	            has_opinion = { who = BRM value = -100 }
	            NOT = { has_opinion = { who = BRM value = -50 } }
	        }
            modifier = {
	            factor = 0
	            NOT = { has_opinion = { who = BRM value = -100 } }
	        }
	        modifier = {
	            factor = 0.8
	            BRM = { has_casus_belli_against = ROOT }
	        }
	    }

        hidden_effect = {
            REB = { change_variable = { which = hansa_votes_brm value = 1 } }
            set_country_flag = hansa_voted
        }
	}

	#Danzig
	option = {
	    name = "vef_hansa.10220.optc"

	    trigger = {
	        exists = DNZ
            DNZ = { is_subject = no }
            has_country_flag = hansa_city_state
            OR = {
                ai = no
                NOT = { tag = DNZ }
            }
	    }

	    ai_chance = {
	        factor = 25
	        modifier = {
	            factor = 1.5
	            capital_scope = {
	                is_strongest_trade_power = DNZ
	            }
	        }
	        modifier = {
	            factor = 1.05
	            capital_scope = {
	                has_trader = DNZ
	            }
	        }
	        modifier = {
	            factor = 0.9
	            army_size = DNZ
	        }
	        modifier = {
	            factor = 0.5
	            prestige = DNZ
	        }
	        modifier = {
	            factor = 0.6
	            num_of_light_ship = DNZ
	        }
	        modifier = {
	            factor = 0.5
	            OR = {
	                trade_embargo_by = DNZ
	                trade_embargoing = DNZ
	            }
	        }
	        modifier = {
	            factor = 0.9
	            has_opinion = { who = DNZ value = 0 }
	            NOT = { has_opinion = { who = DNZ value = 50 } }
	        }
            modifier = {
	            factor = 0.5
	            has_opinion = { who = DNZ value = -50 }
	            NOT = { has_opinion = { who = DNZ value = 0 } }
	        }
   	        modifier = {
	            factor = 0.2
	            has_opinion = { who = DNZ value = -100 }
	            NOT = { has_opinion = { who = DNZ value = -50 } }
	        }
            modifier = {
	            factor = 0
	            NOT = { has_opinion = { who = DNZ value = -100 } }
	        }
	        modifier = {
	            factor = 0.8
	            DNZ = { has_casus_belli_against = ROOT }
	        }
	    }

        hidden_effect = {
            REB = { change_variable = { which = hansa_votes_dnz value = 1 } }
            set_country_flag = hansa_voted
        }
	}

    #Hamburg
	option = {
	    name = "vef_hansa.10220.optd"

	    trigger = {
	        exists = HAM
            HAM = { is_subject = no }
            has_country_flag = hansa_city_state
            OR = {
                ai = no
                NOT = { tag = HAM }
            }
	    }
	    ai_chance = {
	        factor = 25
	        modifier = {
	            factor = 1.5
	            capital_scope = {
	                is_strongest_trade_power = HAM
	            }
	        }
	        modifier = {
	            factor = 1.05
	            capital_scope = {
	                has_trader = HAM
	            }
	        }
	        modifier = {
	            factor = 0.9
	            army_size = HAM
	        }
	        modifier = {
	            factor = 0.5
	            prestige = HAM
	        }
	        modifier = {
	            factor = 0.6
	            num_of_light_ship = HAM
	        }
	        modifier = {
	            factor = 0.5
	            OR = {
	                trade_embargo_by = HAM
	                trade_embargoing = HAM
	            }
	        }
	        modifier = {
	            factor = 0.9
	            has_opinion = { who = HAM value = 0 }
	            NOT = { has_opinion = { who = HAM value = 50 } }
	        }
            modifier = {
	            factor = 0.5
	            has_opinion = { who = HAM value = -50 }
	            NOT = { has_opinion = { who = HAM value = 0 } }
	        }
   	        modifier = {
	            factor = 0.2
	            has_opinion = { who = HAM value = -100 }
	            NOT = { has_opinion = { who = HAM value = -50 } }
	        }
            modifier = {
	            factor = 0
	            NOT = { has_opinion = { who = HAM value = -100 } }
	        }
	        modifier = {
	            factor = 0.8
                HAM = { has_casus_belli_against = ROOT }
	        }
	    }

        hidden_effect = {
            REB = { change_variable = { which = hansa_votes_ham value = 1 } }
            set_country_flag = hansa_voted
        }
	}

	#Self
	option = {
	    name = "vef_hansa.10220.opte"

	    trigger = {
            has_country_flag = hansa_city_state
            is_subject = no
            ai = yes
	    }

	    ai_chance = {
	        factor = 25
	        modifier = {
	            factor = 1.5
	            capital_scope = {
	                is_strongest_trade_power = ROOT
	            }
	        }
	        modifier = {
	            factor = 1.05
	            capital_scope = {
	                has_trader = ROOT
	            }
	        }
	        modifier = {
	            factor = 0.7
	            any_known_country = {
	                OR = {
	                    NOT = { has_country_flag = hansa_city_state }
	                    AND = {
	                        army_size = ROOT
	                        has_country_flag = hansa_city_state
	                    }
	                }
	            }
	        }
	        modifier = {
	            factor = 0.5
	            any_known_country = {
	                OR = {
	                    NOT = { has_country_flag = hansa_city_state }
                        AND = {
                            prestige = ROOT
                            has_country_flag = hansa_city_state
                        }
	                }
	            }
	        }
	        modifier = {
	            factor = 0.3
	            any_known_country = {
	                OR = {
	                    NOT = { has_country_flag = hansa_city_state }
    	                AND = {
    	                    num_of_light_ship = ROOT
    	                    has_country_flag = hansa_city_state
    	                }
    	            }
    	        }
	        }
	    }

        hidden_effect = {
            if = {
                limit = { tag = LUB }
                REB = { change_variable = { which = hansa_votes_lub value = 1 } }
            }
            if = {
                limit = { tag = BRM }
                REB = { change_variable = { which = hansa_votes_brm value = 1 } }
            }
            if = {
                limit = { tag = DNZ }
                REB = { change_variable = { which = hansa_votes_dnz value = 1 } }
            }
            if = {
                limit = { tag = HAM }
                REB = { change_variable = { which = hansa_votes_ham value = 1 } }
            }
            set_country_flag = hansa_voted
        }
	}
}

# Count votes - no leader
country_event = {
	id = vef_hansa.10230
	title = "vef_hansa.10230.t"
	desc = "vef_hansa.10230.d"
	picture = VEF_DEBATE_REPUBLICAN_eventPicture

	trigger = {
		tag = REB
	    has_global_flag = hansa_emergency_vote_started
	    NOT = { exists = HSA }
	    all_known_country = {
	        OR = {
	            NOT = { has_country_flag = hansa_city_state }
                AND = {
            	    has_country_flag = hansa_voted
            	    is_subject = no
            	}
            }
	    }
	}

	mean_time_to_happen = {
	    days = 5
	}

	immediate = {
	    set_global_flag = hansa_emergency_votes_counted
	    clr_global_flag = hansa_emergency_vote_started
	}

    #LUB new leader
    option = {
        name = "vef_hansa.10230.opt"
        trigger = {
            check_variable = { which = hansa_votes_lub which = hansa_votes_dnz }
            check_variable = { which = hansa_votes_lub which = hansa_votes_ham }
        	check_variable = { which = hansa_votes_lub which = hansa_votes_brm }
            NOT = { check_variable = { which = hansa_votes_dnz which = hansa_votes_lub } }
            NOT = { check_variable = { which = hansa_votes_ham which = hansa_votes_lub } }
            NOT = { check_variable = { which = hansa_votes_brm which = hansa_votes_lub } }
        }

        hidden_effect = { LUB = { country_event = { id = vef_hansa.10240 }}}
    }

    #BRM new leader
    option = {
        name = "vef_hansa.10230.opt"

        trigger = {
        	check_variable = { which = hansa_votes_brm which = hansa_votes_dnz }
            check_variable = { which = hansa_votes_brm which = hansa_votes_ham }
            check_variable = { which = hansa_votes_brm which = hansa_votes_lub }
            NOT = { check_variable = { which = hansa_votes_dnz which = hansa_votes_brm }}
            NOT = { check_variable = { which = hansa_votes_ham which = hansa_votes_brm }}
            NOT = { check_variable = { which = hansa_votes_lub which = hansa_votes_brm }}
        }

        hidden_effect = { BRM = { country_event = { id = vef_hansa.10240 }}}
    }

    #DNZ new leader
    option = {
        name = "vef_hansa.10230.opt"
        trigger = {
            check_variable = { which = hansa_votes_dnz which = hansa_votes_lub }
            check_variable = { which = hansa_votes_dnz which = hansa_votes_ham }
            check_variable = { which = hansa_votes_dnz which = hansa_votes_brm }
            NOT = { check_variable = { which = hansa_votes_brm which = hansa_votes_dnz } }
            NOT = { check_variable = { which = hansa_votes_ham which = hansa_votes_dnz } }
            NOT = { check_variable = { which = hansa_votes_lub which = hansa_votes_dnz } }
        }

        hidden_effect = { DNZ = { country_event = { id = vef_hansa.10240 }}}
    }

    #HAM new leader
    option = {
        name = "vef_hansa.10230.opt"
        trigger = {
            check_variable = { which = hansa_votes_ham which = hansa_votes_dnz }
            check_variable = { which = hansa_votes_ham which = hansa_votes_lub }
            check_variable = { which = hansa_votes_ham which = hansa_votes_brm }
            NOT = { check_variable = { which = hansa_votes_dnz which = hansa_votes_ham }}
            NOT = { check_variable = { which = hansa_votes_brm which = hansa_votes_ham }}
            NOT = { check_variable = { which = hansa_votes_lub which = hansa_votes_ham }}
        }

        hidden_effect = { HAM = { country_event = { id = vef_hansa.10240 }}}
    }
}

# New leader - emergency vote - leader
country_event = {
	id = vef_hansa.10240
	title = "vef_hansa.10240.t"
	desc = "vef_hansa.10240.d"
	picture = VEF_DEBATE_REPUBLICAN_eventPicture

	is_triggered_only = yes	#vef_hansa.10220

	major = yes

	trigger = {
	    NOT = { exists = HSA }
	}

	immediate = {
	    hidden_effect = {
   	        clr_global_flag = hansa_no_leader
	        clr_country_flag = hansa_voted
            set_variable = { which = hansa_consecutive_votes value = 1 }
            define_ruler = {}
	        every_country = {
	            limit = {
	                has_country_flag = hansa_city_state
	                NOT = { tag = ROOT }
	                is_subject = no
	            }
	            ROOT = { create_subject = { subject_type = hansa_union subject = PREV }}
                country_event = { id = vef_hansa.10060 }
	        }
            set_country_flag = hansa_leader
            save_global_event_target_as = hansa_leader_tag
        }
	}

	option = {
	    name = "vef_hansa.10240.opta"
	    add_prestige = 20
	    add_scaled_republican_tradition = 0.10
	    add_country_modifier = { name = "hansa_leader_modifier" duration = -1 }
	    hidden_effect = {
	        clr_global_flag = hansa_emergency_vote
	    }

	}
}

#No longer valid member
country_event = {
    id = vef_hansa.11000
    title = "vef_hansa.11000.t"
    desc = "vef_hansa.11000.d"
    picture = VEF_HANSEATIC_LEAGUE_eventPicture

    trigger = {
        has_country_modifier = hanseatic_league_member
        hansa_group = { type = all NOT = { owned_by = ROOT } }
    }

    option = {
        name = "vef_hansa.11000.opta"
        add_prestige = -20
		add_country_modifier = { name = "left_the_hanseatic_league" duration = 730 }
		remove_country_modifier = hanseatic_league_member
		every_known_country = { remove_opinion = { who = PREV modifier = hanseatic_league_friendship }}
		hidden_effect = {
			if = {
			    limit = { exists = HSA }
			    HSA = { country_event = { id = vef_hansa.11001 days = 0 } }
			}
			if = {
			    limit = { NOT = { exists = HSA } }
			    every_known_country = {
			        limit = { has_country_flag = hansa_leader }
			        country_event = { id = vef_hansa.11001 days = 0 }
			    }
			}
		}
    }
}

#Inform Hansa Leader
country_event = {
    id = vef_hansa.11001
    title = "vef_hansa.11001.t"
    desc = "vef_hansa.11001.d"
    picture = VEF_HANSEATIC_LEAGUE_eventPicture

    is_triggered_only = yes

    option = {
        name = "vef_hansa.11001.opta"
    }
}


#################
# Hansa Kontors #
#################

# Hansa cease to exist.
country_event = {
	id = vef_hansa.20000
	title = "vef_hansa.20000.t"
	desc = "vef_hansa.20000.d"
	picture = VEF_HANSEATIC_LEAGUE_eventPicture

	fire_only_once = yes

	trigger = {
		tag = REB
	    NOT = { exists = HSA }
		DNZ = { NOT = { has_country_flag = hansa_leader } }
		BRM = { NOT = { has_country_flag = hansa_leader } }
		LUB = { NOT = { has_country_flag = hansa_leader } }
		HAM = { NOT = { has_country_flag = hansa_leader } }
		NOT = { has_global_flag = hansa_emergency_vote }
		NOT = { has_global_flag = hansa_disbanded }
	}
	
	mean_time_to_happen = { months = 12 }

	immediate = {
		set_global_flag = hansa_disbanded
		every_country = {
			limit = { has_country_modifier = hanseatic_league_member }
			country_event = { id = vef_hansa.20001 }
		}
	}

	option = {
		name = "vef_hansa.20000.opta"
	}
}

# Hansa cease to exist.
country_event = {
	id = vef_hansa.20001
	title = "vef_hansa.20001.t"
	desc = "vef_hansa.20001.d"
	picture = VEF_HANSEATIC_LEAGUE_eventPicture
	
	is_triggered_only = yes # vef_hansa.20000
	
	immediate = {
		remove_country_modifier = hanseatic_league_member
		remove_country_modifier = hansa_leader_modifier
		remove_country_modifier = hansa_city_state_modifier
	}

	option = {
		name = "vef_hansa.20001.opta"
		add_prestige = -10
		every_known_country = {
			remove_opinion = { who = PREV modifier = hanseatic_league_friendship }
		}
		every_owned_province = {
			limit = { has_building = hansa_kontor }
			remove_building = hansa_kontor
		}
	}
}

#Kontor Captured - Eligible to Join
country_event = {
	id = vef_hansa.20002
	title = "vef_hansa.20002.t"
	desc = "vef_hansa.20002.d"
	picture = VEF_HANSEATIC_LEAGUE_eventPicture

	trigger = {
		any_owned_province = { has_building = hansa_kontor }
		NOT = { has_country_modifier = hanseatic_league_member }
		OR = {
			culture_group = germanic
			culture_group = scandinavian
			culture_group = west_slavic
			culture_group = east_slavic
			culture_group = baltic
			primary_culture = english
		}
		NOT = { has_country_modifier = betrayed_the_hansa }
		NOT = { event_target:hansa_leader_tag = { is_rival = ROOT }}
		event_target:hansa_leader_tag = { has_opinion = { who = ROOT value = 25 }}

	}

	# Join the League
	option = {
		name = "vef_hansa.20002.opta"
		ai_chance = { factor = 80 }
		add_dip_power = -25
		add_country_modifier = { name = "hanseatic_league_member" duration = -1 }
		add_mercantilism = -0.25
		every_country = {
			limit = { has_country_modifier = hanseatic_league_member }
			add_opinion = { who = PREV modifier = hanseatic_league_friendship }
		}  
	}

	# Order the Kontors closed
	option = {
		name = "vef_hansa.20002.optb"
		ai_chance = { factor = 20 }
		every_owned_province = {
			limit = { has_building = hansa_kontor }
			remove_building = hansa_kontor
		}
	}
}

#Captured Kontor - Not eligible
country_event = {
	id = vef_hansa.20003
	title = "vef_hansa.20003.t"
	desc = "vef_hansa.20003.d"
	picture = VEF_HANSEATIC_LEAGUE_eventPicture

	is_triggered_only = yes #on_actions/on_peace

	trigger = {
		any_owned_province = { has_building = hansa_kontor }
		NOT = { has_country_modifier = hanseatic_league_member }
		NOT = { culture_group = germanic }
		NOT = { culture_group = scandinavian }
		NOT = { culture_group = west_slavic }
		NOT = { culture_group = east_slavic }
		NOT = { culture_group = baltic }
		NOT = { primary_culture = english }
		OR = {
			has_country_modifier = betrayed_the_hansa
			event_target:hansa_leader_tag = { is_rival = ROOT }
			NOT = { event_target:hansa_leader_tag = { has_opinion = { who = ROOT value = 25 }}}
		}
	}

	# Order the Kontors closed
	option = {
		name = "vef_hansa.20003.opta"
		every_owned_province = {
			limit = { has_building = hansa_kontor }
			remove_building = hansa_kontor
		}
	}
}

# Kontors for the Hansa Provinces
province_event = {
	id = vef_hansa.30000
	title = "vef_hansa.30000.t"
	desc = "vef_hansa.30000.d"

	trigger = {
		OR = {
			province_id = 377
			province_id = 379
			province_id = 381
		}
		owner = {
            OR = {
                government = hanseatic_union
                government = hanseatic_league
            }
        }
		NOT = { has_building = hansa_kontor }
		NOT = { has_building = farm_estate }
		NOT = { has_building = fine_arts_academy }
		NOT = { has_building = plantations }
		NOT = { has_building = fishery }
		NOT = { has_building = wharf }
		NOT = { has_building = tradecompany }
		NOT = { has_building = textile }
		NOT = { has_building = weapons }
		NOT = { has_building = refinery }
	}

	mean_time_to_happen = { months = 120 }

	picture = VEF_HANSEATIC_LEAGUE_eventPicture

	option = {
		name = "vef_trade.10032.opta"
		add_building = hansa_kontor
	}
}

#Kontor Background
country_event = {
	id = vef_hansa.30001
	title = "vef_hansa.30001.t"
	desc = "vef_hansa.30001.d"
	picture = VEF_HANSEATIC_LEAGUE_eventPicture

	hidden = yes

	trigger = {
		event_target:hansa_leader_tag = { tag = ROOT }
	}

	mean_time_to_happen = { months = 240 }


	option = {
		name = "vef_hansa.30001.opta"
		random_province = {
			limit = {
				has_province_flag = kontor_possible
				owner = {
					has_country_modifier = hanseatic_league_member
					NOT = { has_country_modifier = kontor_cooldown }
					ROOT = { has_opinion = { who = PREV value = 75 }}
					NOT = { ROOT = { is_rival = PREV }}
					NOT = { is_rival = ROOT }
				}
			}
			province_event = { id = vef_hansa.30002 days = 7 }
		}
	}
}

#Kontor Offered
province_event = {
	id = vef_hansa.30002
	title = "vef_hansa.30002.t"
	desc = "hansa.30002.d"
	picture = VEF_HANSEATIC_LEAGUE_eventPicture
	
	is_triggered_only = yes #vef_hansa.30001

	option = {
		name = "vef_hansa.30002.opta"
		ai_chance = { factor = 100 }
		owner = { add_mercantilism = -0.02 }
		add_building = hansa_kontor
		owner = {
			if = {
				limit = { ai = no }
				if = { 
					limit = { NOT = { monthly_income = 5 } }
					add_treasury = -40
				}
				if = { 
					limit = { 
						monthly_income = 5
						NOT = { monthly_income = 10 }
					}
					add_treasury = -60
				}
				if = { 
					limit = { monthly_income = 10 }
					add_treasury = -100
				}
			}
			add_adm_power = -25
			add_prestige = 25
			hidden_effect = { 
				add_country_modifier = { name = "kontor_cooldown" duration = 5475 hidden = yes }
				event_target:hansa_leader_tag = { country_event = { id = vef_hansa.30003 }}
			}
		}
	}

	option = {
		name = "vef_hansa.30002.optb"
		trigger = { owner = { ai = no } }
        event_target:hansa_leader_tag = { add_opinion = { who = ROOT modifier = kontor_declined }}
        hidden_effect = {
			owner = { add_country_modifier = { name = "declined_kontor" duration = 1825 hidden = yes }}
		}
	}
}

# Notify the Hansa of the new Kontor
country_event = {
	id = vef_hansa.30003
	title = "vef_hansa.30003.t"
	desc = "vef_hansa.30003.d"

	is_triggered_only = yes #vef_hansa.30002

	picture = VEF_HANSEATIC_LEAGUE_eventPicture

	option = {
		name = "vef_hansa.30003.opta"
	}
}

#Kontors Close on War
country_event = {
	id = vef_hansa.30004
	title = "vef_hansa.30004.t"
	desc = "hansa.30004.d"
	picture = VEF_HANSEATIC_LEAGUE_eventPicture
	
	is_triggered_only = yes # diplomatic_actions/declarewar
	
	immediate = {
		every_owned_province = {
			limit = { has_building = hansa_kontor }
			remove_building = hansa_kontor
		}
	}
	
	option = {
		name = "vef_hansa.30004"
	}
}

# Hansa have expelled us
country_event = {
	id = vef_hansa.40000
	title = "vef_hansa.40000.t"
	desc = "vef_hansa.40000.d"
	picture = VEF_MERCHANTS_TALKING_eventPicture

	is_triggered_only = yes	#decisions/vef_hanseatic_league

	immediate = { 
		add_country_modifier = { name = "expelled_by_hansa" duration = 1825 } 
		remove_country_modifier = hanseatic_league_member
        every_owned_province = {
			limit = { has_building = hansa_kontor }
			remove_building = hansa_kontor
		}
	}

	option = {
		name = "vef_hansa.40000.opta"
		add_prestige = -10
		every_country = {
		    limit = { has_country_modifier = hanseatic_league_member }
		   reverse_remove_opinion = { who = ROOT modifier = hanseatic_league_friendship }
		}
	}
}

# Member Departs
country_event = {
	id = vef_hansa.40001
	title = "vef_hansa.40001.t"
	desc = "vef_hansa.40001.d"
	picture = VEF_MERCHANTS_TALKING_eventPicture

	is_triggered_only = yes #decisions/vef_hanseatic_league
	
	option = {
		name = "vef_hansa.40001.opta"
	}
}

# Member Joins
country_event = {
	id = vef_hansa.40002
	title = "vef_hansa.40002.t"
	desc = "vef_hansa.40002.d"
	picture = VEF_MERCHANTS_TALKING_eventPicture

	is_triggered_only = yes #decisions/vef_hanseatic_league
	
	option = {
		name = "vef_hansa.40002.opta"
	}
}